<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tamiru | Cloud Terminal</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg:#010409;
  --panel:rgba(13,17,23,.9);
  --blue:#38bdf8;
  --text:#f1f5f9;
}

html,body{
  margin:0;
  height:100%;
  background:var(--bg);
  color:var(--text);
  font-family:Inter,system-ui;
  overflow:hidden;
}

canvas{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:1;
}

#branchCanvas{
  right:0;
  width:360px;
}

.layout{
  display:flex;
  height:100%;
  position:relative;
  z-index:2;
}

.sidebar{
  width:300px;
  background:var(--panel);
  backdrop-filter:blur(20px);
  padding:24px;
  display:flex;
  flex-direction:column;
  gap:18px;
  border-right:1px solid rgba(56,189,248,.25);
}

.brand{
  text-align:center;
  font-size:1.6rem;
  font-weight:900;
  letter-spacing:2px;
}
.brand span{
  color:var(--blue);
  text-shadow:0 0 10px var(--blue);
}

.vault{
  border:1px dashed var(--blue);
  border-radius:12px;
  padding:12px;
  background:rgba(255,255,255,.03);
}
#file-list{
  margin-top:8px;
  font-size:.75rem;
  max-height:140px;
  overflow:auto;
}
.file-item{
  color:var(--blue);
  cursor:pointer;
  padding:4px 0;
}
.file-item:hover{color:white}

.ai{
  border:1px solid rgba(56,189,248,.3);
  border-radius:12px;
  padding:12px;
  background:rgba(15,23,42,.6);
}
#ai-display{
  height:110px;
  overflow:auto;
  font-size:.75rem;
  color:#94a3b8;
  margin-bottom:6px;
}
.ai-input{
  width:100%;
  background:rgba(0,0,0,.4);
  border:1px solid rgba(56,189,248,.3);
  color:white;
  padding:6px;
  border-radius:6px;
}

.viewport{
  flex:1;
  padding:60px;
  overflow:auto;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:25px;
}
.card{
  background:rgba(30,41,59,.4);
  padding:20px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.05);
  text-decoration:none;
  color:inherit;
  transition:.3s;
}
.card:hover{
  transform:translateY(-5px);
  border-color:var(--blue);
  box-shadow:0 0 20px rgba(56,189,248,.15);
}

#lock{
  position:fixed;
  inset:0;
  background:black;
  z-index:999;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}
</style>
</head>

<body>

<canvas id="petalCanvas"></canvas>
<canvas id="branchCanvas"></canvas>

<div id="lock">
  <div style="font-size:4rem">üí†</div>
  <h2 style="letter-spacing:5px">SECURE TERMINAL</h2>
  <button onclick="unlock()" style="margin-top:20px;padding:10px 40px;border-radius:20px;background:none;border:1px solid var(--blue);color:var(--blue)">
    DECRYPT
  </button>
</div>

<div class="layout">

<aside class="sidebar">
  <div class="brand">TAMIRU<span>.OS</span></div>

  <div class="vault">
    ‚òÅÔ∏è CLOUD VAULT
    <input type="file" id="fileInput" hidden onchange="uploadFile(this.files)">
    <button onclick="fileInput.click()" style="margin-top:8px;width:100%;background:var(--blue);border:none;padding:6px;border-radius:6px;font-weight:bold">
      Upload
    </button>
    <div id="file-list">Connecting...</div>
  </div>

  <div class="ai">
    <div id="ai-display"><b>AI:</b> Ready.</div>
    <input class="ai-input" placeholder="Ask AI..." onkeydown="if(event.key==='Enter') sendAI(this)">
  </div>

  <div style="margin-top:auto;font-size:.6rem;text-align:center;color:#475569">
    SUPABASE + AI ACTIVE
  </div>
</aside>

<main class="viewport">
  <h1 id="greet">Initializing...</h1>
  <div class="grid">
    <a class="card" href="https://docs.google.com/presentation/d/1mb_ml9u7dmVj4ABoY8W8sZXyMbVKSdz1/export/pptx">
      <h3>üèõÔ∏è History</h3>
      <p>Class Presentation</p>
    </a>
  </div>
</main>

</div>

<script>
// ========= SUPABASE =========
const supabaseClient = supabase.createClient(
  "https://bkvafwjwkwwxpspxdggs.supabase.co",
  "PASTE_YOUR_PUBLIC_ANON_KEY_HERE"
);

// ========= LOCK =========
function unlock(){
  if(prompt("Security Key") === "2026"){
    document.getElementById("lock").style.transform="translateY(-100%)";
    document.getElementById("greet").innerText="Welcome, Tamiru";
    loadFiles();
  }
}

// ========= VAULT =========
async function uploadFile(files){
  if(!files.length) return;
  const f = files[0];
  await supabaseClient.storage
    .from("vault")
    .upload(Date.now()+"_"+f.name,f);
  loadFiles();
}

async function loadFiles(){
  const {data,error} = await supabaseClient.storage.from("vault").list();
  const list = document.getElementById("file-list");
  if(error){ list.innerText="Error"; return; }
  list.innerHTML = data.length
    ? data.map(f=>`<div class="file-item" onclick="openFile('${f.name}')">üìÑ ${f.name.split('_')[1]}</div>`).join("")
    : "Vault empty";
}

function openFile(name){
  const {data} = supabaseClient.storage.from("vault").getPublicUrl(name);
  window.open(data.publicUrl);
}

// ========= REAL AI =========
async function sendAI(input){
  const msg = input.value.trim();
  if(!msg) return;
  input.value="";
  const display = document.getElementById("ai-display");

  display.innerHTML += `<br><span style="color:white">> ${msg}</span>`;
  display.scrollTop = display.scrollHeight;

  try{
    const res = await fetch(
      "https://bkvafwjwkwwxpspxdggs.functions.supabase.co/ai-chat",
      {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ message: msg })
      }
    );
    const data = await res.json();
    display.innerHTML += `<br><b>AI:</b> ${data.reply}`;
  }catch{
    display.innerHTML += `<br><b>AI:</b> Connection error.`;
  }
  display.scrollTop = display.scrollHeight;
}

// ========= SAKURA =========
const pCtx = document.getElementById("petalCanvas").getContext("2d");
const bCtx = document.getElementById("branchCanvas").getContext("2d");

petalCanvas.width = innerWidth;
petalCanvas.height = innerHeight;
branchCanvas.width = 360;
branchCanvas.height = innerHeight;

const petals = Array.from({length:60},()=>({
  x: innerWidth - Math.random()*200,
  y: Math.random()*innerHeight,
  s: Math.random()*6+4
}));

let t=0;
function animate(){
  pCtx.clearRect(0,0,innerWidth,innerHeight);
  petals.forEach(p=>{
    p.y+=0.8; p.x-=0.4;
    if(p.y>innerHeight) p.y=-20;
    pCtx.fillStyle="rgba(150,200,255,.7)";
    pCtx.beginPath();
    pCtx.ellipse(p.x,p.y,p.s,p.s*1.4,0,0,Math.PI*2);
    pCtx.fill();
  });

  bCtx.clearRect(0,0,360,innerHeight);
  t+=0.01;
  bCtx.strokeStyle="#3b2f2f";
  bCtx.lineWidth=6;
  bCtx.beginPath();
  bCtx.moveTo(340,0);
  bCtx.quadraticCurveTo(200+Math.sin(t)*10,innerHeight/2,120,innerHeight);
  bCtx.stroke();

  requestAnimationFrame(animate);
}
animate();
</script>

</body>
</html>
